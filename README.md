# SSVEP Brain Signal Detection using CCA

基于典型相关分析（CCA）的稳态视觉诱发电位（SSVEP）脑电信号检测系统。

## 📋 项目描述

本项目实现了使用 CCA 算法对 SSVEP 脑电信号进行频率识别，可以准确识别用户注视的刺激频率（8种频率）。

### ✨ 特性

- **算法**：典型相关分析（Canonical Correlation Analysis, CCA）
- **准确率**：100% （在优化参数下）
- **支持频率**：8种 (9Hz, 10Hz, 11Hz, 12Hz, 13Hz, 15Hz, 16Hz, 10.58Hz)
- **采样率**：250 Hz
- **优化数据窗口**：4-5 秒

## 🚀 快速开始

### 安装依赖

```bash
pip install numpy pandas scikit-learn scipy
```

### 基本使用

```python
from ssvepdetect import ssvepDetect
import numpy as np

# 参数配置
srate = 250  # 采样率
freqs = [16.0, 9.0, 10.0, 11.0, 12.0, 13.0, 10.58, 15.0]  # 8个刺激频率
dataLen = 4.0  # 使用4秒的数据窗口（关键！）

# 创建检测器
detector = ssvepDetect(srate, freqs, dataLen)

# 加载EEG信号（形状: 6个通道 × 1000个样本@250Hz）
data = np.random.randn(6, 1000)

# 进行检测
detected_index = detector.detect(data)
detected_freq = freqs[detected_index]

print(f"检测到的频率: {detected_freq} Hz")
```

## 📁 项目文件

- **`ssvepdetect.py`** - CCA算法核心实现
  - `__init__()` - 初始化，生成参考模板
  - `pre_filter()` - 预处理（陷波和带通滤波）
  - `detect()` - 主检测函数

- **`test_ssvep_corrected.py`** - 完整测试脚本，展示正确的使用方法
  - 演示如何使用正确的频率映射
  - 测试D1.csv和D2.csv示例数据
  
- **`optimize_ssvep.py`** - 参数优化和诊断脚本
  - 测试不同数据窗口长度的影响
  - 分析CCA相关系数

- **`diagnose_ssvep_freq.py`** - 频率诊断脚本
  - 通过FFT分析每个刺激的真实频率
  - 验证stimID到频率的映射

- **`SSVEP_CCA算法分析总结.md`** - 完整的分析文档
  - CCA原理详解
  - 问题诊断和解决方案
  - 参数优化建议

## 📊 示例数据

项目包含示例数据：

- **`ExampleData/D1.csv`** - 示例数据文件1 (48000行)
- **`ExampleData/D2.csv`** - 示例数据文件2 (48000行)

数据格式：
```
CP3, CPZ, CP4, PO3, POZ, PO4, taskID, stimID
-3.36, 1.03, -4.27, -4.55, -6.38, -1.34, 0.0, 1.0
...
```

其中：
- 前6列：EEG信号（6个导联）
- 第7列：任务编号（taskID）
- 第8列：刺激编号（stimID，0-7）

## 🔑 关键参数说明

| 参数 | 默认值 | 说明 |
|------|-------|------|
| `srate` | 250 | 采样率（Hz） |
| `freqs` | [16.0, 9.0, ...] | 8个刺激频率列表 |
| `dataLen` | 4.0 | 数据窗口长度（秒）**[重要]** |

### ⚠️ 重要提示

**数据窗口长度对准确率的影响**：

| 窗口长度 | 准确率 |
|---------|-------|
| 2.0秒 | 50% |
| 3.0秒 | 87.5% |
| **4.0秒** | **100%** ⭐ |
| 5.0秒 | 100% |
| 6.0秒 | 87.5% |

**最优配置：`dataLen = 4.0` （4秒）**

## 🔍 常见问题

### Q: 检测准确率很低？
**A**: 
1. 检查频率列表是否与实际刺激频率对应
2. 增加 `dataLen` 到4-5秒
3. 检查原始EEG信号质量

### Q: 为什么有些频率总是识别错误？
**A**: 可能是滤波参数不适配，可以调整 `pre_filter()` 中的带通滤波范围。

### Q: CCA相关系数都很低？
**A**: 这表示信号质量可能有问题。检查：
- 电极接触是否良好
- 是否有严重的电磁干扰
- 数据是否已正确预处理

## 📈 检测流程

```
原始EEG信号
    ↓
[预处理] 陷波 + 带通滤波
    ↓
[参考模板] sin/cos @ 8个频率
    ↓
[CCA计算] 计算与8个模板的相关系数
    ↓
[判断] 选择相关系数最高的频率
    ↓
检测结果（0-7对应的频率）
```

## 📚 原理参考

### CCA在SSVEP中的原理

1. **信号包含特定频率**：被试注视某频率刺激时，脑电信号包含该频率成分
2. **参考模板匹配**：生成对应刺激频率的sin/cos参考信号
3. **相关性最大化**：CCA找到最优线性组合，使相关性最高
4. **频率识别**：相关系数最高的频率即为目标频率

## 📝 更新日志

- **2025-11-10** - 项目初版
  - 实现基础CCA算法
  - 解决频率映射问题（0% → 100%）
  - 优化参数配置
  - 完成文档

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License

---

**维护者**: shiro123444

**最后更新**: 2025年11月10日
